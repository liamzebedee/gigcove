$ curl -L https://github.com/orchardup/fig/releases/download/0.5.1/linux > /usr/local/bin/fig
$ chmod +x /usr/local/bin/fig

$ fig run web rails new . --force --database=postgresql --skip-bundle

Uncomment the line in your new Gemfile which loads therubyracer, so we've got a Javascript runtime:

gem 'therubyracer', platforms: :ruby

Now that we've got a new Gemfile, we need to build the image again. (This, and changes to the Dockerfile itself, should be the only times you'll need to rebuild).

$ fig build

Open up your newly-generated database.yml. Replace its contents with the following:

development: &default
  adapter: postgresql
  encoding: unicode
  database: myapp_development
  pool: 5
  username: docker
  password: docker
  host: <%= ENV.fetch('DB_1_PORT_5432_TCP_ADDR', 'localhost') %>
  port: <%= ENV.fetch('DB_1_PORT_5432_TCP_PORT', '5432') %>

test:
  <<: *default
  database: myapp_test

We can now boot the app.

$ fig up

Finally, we just need to create the database. In another terminal, run:

$ fig run web rake db:create

